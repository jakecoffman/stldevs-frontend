<dom-module id="selected-language">
  <style>
    .user {
      padding: 16px;
      margin-bottom: 16px;
      background: white;
    }
    .repo {
      font-weight: bold;
    }
  </style>
  <template>
    <iron-ajax id="ajax"
               handle-as="json"
               loading="{{loading}}"
               last-response="{{data}}"></iron-ajax>

    <template is="dom-repeat" items="{{data.languages}}">
      <paper-material elevation="1" class="user">
        <a href="{{_getProfileLink(item.Owner)}}" class="paper-font-display1">{{item.Owner}}</a>
        <div class="layout horizontal">
          <div>
            <p><span>{{_numStars(item.Repos)}}</span> stars in <span>[[data.language]]</span></p>
            <p><span>{{_numRepos(item.Repos)}}</span> repos in <span>[[data.language]]</span></p>
          </div>
          <div class="flex">
            <ul>
              <template is="dom-repeat" items="{{_topThree(item.Repos)}}" as="repo">
                <li><span class="repo">[[repo.Name]]</span> - <span>[[repo.Stargazers]]</span> <span>[[repo.ForksCount]]</span> <span>[[repo.Description]]</span></li>
              </template>
            </ul>
          </div>
        </div>
      </paper-material>
    </template>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'selected-language',
        properties: {
          language: {
            type: String,
            observer: '_languageChanged'
          },
          loading: {
            type: Boolean,
            notify: true
          }
        },
        _languageChanged: function() {
          this.$.ajax.url = 'http://' + location.hostname + '/lang/' + this.language;
          this.$.ajax.generateRequest();
        },
        _numStars: function(repos) {
          var sum = 0;
          for (var i=0; i < repos.length; i++) {
            sum += repos[i].StargazersCount;
          }
          return sum;
        },
        _numRepos: function(repos) {
          return repos.length;
        },
        _topThree: function(repos) {
          var three = [];
          for (var i=0; i < repos.length && i < 3; i++) {
            three.push(repos[i]);
          }
          return three;
        },
        _getProfileLink: function(user) {
          return "/profile/" + user;
        }
      });
    })();
  </script>

</dom-module>
